# 系统改进功能使用指南

本指南介绍了Milvus系统的三个主要改进功能：简化GLM配置、增强聚类可视化和集成Locust压测。

## 🤖 GLM-4.5-flash 配置

### 功能概述
简化的GLM配置界面专门为智谱AI的GLM-4.5-flash模型优化，提供一键配置体验。

### 使用步骤

1. **打开配置界面**
   - 在主界面找到"GLM-4.5-flash 配置"展开面板
   - 点击展开查看配置选项

2. **配置GLM模型**
   - 输入模型名称（默认：glm-4.5-flash）
   - 输入智谱AI API密钥
   - 点击"验证密钥"测试连接
   - 点击"保存配置"完成设置

3. **获取API密钥**
   - 访问 [智谱AI开放平台](https://open.bigmodel.cn/)
   - 注册并登录账户
   - 在控制台中创建API密钥
   - 复制密钥到配置界面

### 功能特点
- ✅ 专为GLM-4.5-flash优化
- ✅ API密钥加密存储
- ✅ 实时连接测试
- ✅ 自动配置验证
- ✅ 支持高级分块策略（PPL、MSP）

### 故障排除
- **API密钥无效**：检查密钥是否正确复制，确保没有多余空格
- **连接失败**：检查网络连接，确认API服务可用
- **配置丢失**：配置文件损坏时会自动重置，需要重新配置

## 🎨 聚类可视化分析

### 功能概述
增强的聚类可视化功能提供多维度的搜索结果分析，包括散点图、饼图、热力图等。

### 使用步骤

1. **执行搜索**
   - 在"检索与可视"界面输入查询问题
   - 选择聚类算法（HDBSCAN/KMeans）
   - 勾选"启用聚类可视化"
   - 点击"开始检索与可视"

2. **查看可视化结果**
   - **聚类分布图**：查看文档在2D空间中的分布
   - **聚类大小**：饼图显示各聚类的文档数量
   - **相似度热力图**：聚类间相似度关系
   - **聚类摘要**：详细的聚类统计信息

3. **交互式分析**
   - 悬停查看文档内容预览
   - 点击聚类查看详细信息
   - 查看关键词和代表性文档

### 可视化组件说明

#### 📊 聚类分布图
- 使用t-SNE/UMAP/PCA降维算法
- 不同颜色代表不同聚类
- 支持大数据量性能优化（自动采样）

#### 🥧 聚类大小分布
- 饼图展示各聚类文档数量
- 百分比和绝对数量显示
- 交互式图例

#### 🔥 相似度热力图
- 聚类间余弦相似度矩阵
- 颜色深浅表示相似度高低
- 帮助理解聚类关系

#### 📋 聚类摘要
- 总体统计信息
- 每个聚类的详细信息
- 关键词提取结果
- 代表性文档内容

### 性能优化
- 大数据量自动采样（>1000个点）
- 智能降维算法选择
- 响应式界面设计
- 异步数据加载

## 🚀 Locust压测集成

### 功能概述
集成Locust压力测试工具，提供Web界面访问和实时监控功能。

### 使用步骤

1. **配置压测参数**
   - 在"性能监控与压测"界面找到压测配置
   - 设置并发用户数（1-100）
   - 设置用户启动速率（用户/秒）
   - 选择测试持续时间（30s-600s）

2. **选择测试场景**
   - 单向量搜索：最常见的搜索操作
   - 批量向量搜索：批量搜索操作
   - 高精度搜索：高精度但较慢的搜索
   - 快速搜索：快速但精度较低的搜索

3. **配置搜索参数**
   - 距离度量：L2/IP/COSINE
   - nprobe参数：搜索时探测的聚类数量
   - 返回结果数：每次搜索返回的结果数

4. **启动压测**
   - 点击"启动压力测试"
   - 系统会显示测试ID和Web界面链接
   - 点击链接在新窗口打开Locust界面

5. **监控测试**
   - 在Locust Web界面查看实时数据
   - 监控请求速率、响应时间、错误率
   - 查看详细的性能图表

6. **管理测试**
   - 在"测试状态管理"查看所有测试
   - 停止运行中的测试
   - 查看测试历史记录

### Locust Web界面功能
- 📈 实时性能图表
- 📊 请求统计数据
- 🔍 错误日志查看
- ⚙️ 测试参数调整
- 📥 结果数据下载

### 测试场景说明

#### 单向量搜索
- 模拟最常见的单次向量搜索
- 适合测试基础搜索性能

#### 批量向量搜索
- 模拟批量搜索操作
- 测试系统并发处理能力

#### 高精度搜索
- 使用更高的搜索参数
- 测试高质量搜索的性能

#### 快速搜索
- 使用较低的搜索参数
- 测试快速响应场景

## 🔧 系统集成

### 配置文件管理
所有配置都会自动保存到相应的配置文件：
- GLM配置：`glm_config.json`（加密存储）
- 系统配置：`config.yaml`
- 压测配置：动态生成

### API端点
新增的API端点：
- `/glm/config` - GLM配置管理
- `/glm/test-connection` - 连接测试
- `/search` - 增强搜索（包含可视化）
- `/load-test/start` - 启动压测
- `/load-test/status/{test_id}` - 测试状态
- `/load-test/stop/{test_id}` - 停止测试

### 错误处理
系统提供完善的错误处理机制：
- API密钥验证失败自动提示
- 网络连接问题自动重试
- 可视化生成失败不影响基础搜索
- 压测启动失败提供详细错误信息

## 📋 最佳实践

### GLM配置
1. 定期测试API连接状态
2. 保护好API密钥，不要泄露
3. 监控API使用额度
4. 及时更新过期的密钥

### 聚类可视化
1. 对于大量数据，建议启用采样优化
2. 根据数据特点选择合适的降维算法
3. 关注聚类质量指标，调整搜索参数
4. 利用关键词理解聚类主题

### 压力测试
1. 从小规模测试开始，逐步增加负载
2. 监控系统资源使用情况
3. 记录测试结果，建立性能基线
4. 定期进行回归测试
5. 测试完成后及时停止，释放资源

## 🚨 注意事项

### 安全考虑
- API密钥采用加密存储
- 压测仅限于测试环境
- 避免在生产环境进行高负载测试
- 定期更新和轮换API密钥

### 性能考虑
- 大数据量可视化会消耗较多内存
- 高并发压测可能影响系统稳定性
- 建议在非高峰时段进行压测
- 监控系统资源使用情况

### 兼容性
- 需要Python 3.7+
- 依赖Streamlit、Plotly、Locust等库
- 建议使用最新版本的依赖包
- 确保网络连接稳定

## 📞 技术支持

如遇到问题，请检查：
1. 系统日志文件
2. API响应错误信息
3. 网络连接状态
4. 依赖包版本兼容性

常见问题解决方案请参考故障排除部分，或联系技术支持团队。